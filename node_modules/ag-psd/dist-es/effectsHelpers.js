import { readColor } from './helpers';
import { checkSignature, readSignature, skipBytes, readUint16, readUint8, readUint32, readInt32 } from './psdReader';
function readBlendMode(reader) {
    checkSignature(reader, '8BIM');
    return readSignature(reader);
}
function readShadowInfo(reader) {
    var size = readUint32(reader);
    var version = readUint32(reader);
    if (size !== 41 && size !== 51)
        throw new Error("Invalid effects shadow info size: " + size);
    if (version !== 0 && version !== 2)
        throw new Error("Invalid effects shadow info version: " + version);
    var blur = readInt32(reader);
    var intensity = readInt32(reader);
    var angle = readInt32(reader);
    var distance = readInt32(reader);
    var color = readColor(reader);
    var blendMode = readBlendMode(reader);
    var enabled = !!readUint8(reader);
    var useAngleInAllEffects = !!readUint8(reader);
    var opacity = readUint8(reader);
    var nativeColor = size >= 51 ? readColor(reader) : undefined;
    return { blur: blur, intensity: intensity, angle: angle, distance: distance, color: color, blendMode: blendMode, enabled: enabled, useAngleInAllEffects: useAngleInAllEffects, opacity: opacity, nativeColor: nativeColor };
}
function readOuterGlowInfo(reader) {
    var size = readUint32(reader);
    var version = readUint32(reader);
    if (size !== 32 && size !== 42)
        throw new Error("Invalid effects outer glow info size: " + size);
    if (version !== 0 && version !== 2)
        throw new Error("Invalid effects outer glow info version: " + version);
    var blur = readUint32(reader);
    var intensity = readUint32(reader);
    var color = readColor(reader);
    var blendMode = readBlendMode(reader);
    var enabled = !!readUint8(reader);
    var opacity = readUint8(reader);
    var nativeColor = size >= 42 ? readColor(reader) : undefined;
    return { blur: blur, intensity: intensity, color: color, blendMode: blendMode, enabled: enabled, opacity: opacity, nativeColor: nativeColor };
}
function readInnerGlowInfo(reader) {
    var size = readUint32(reader);
    var version = readUint32(reader);
    if (size !== 33 && size !== 43)
        throw new Error("Invalid effects inner glow info size: " + size);
    if (version !== 0 && version !== 2)
        throw new Error("Invalid effects inner glow info version: " + version);
    var blur = readUint32(reader);
    var intensity = readUint32(reader);
    var color = readColor(reader);
    var blendMode = readBlendMode(reader);
    var enabled = !!readUint8(reader);
    var opacity = readUint8(reader);
    var invert = size >= 43 ? !!readUint8(reader) : undefined;
    var nativeColor = size >= 43 ? readColor(reader) : undefined;
    return { blur: blur, intensity: intensity, color: color, blendMode: blendMode, enabled: enabled, opacity: opacity, invert: invert, nativeColor: nativeColor };
}
function readBevelInfo(reader) {
    var size = readUint32(reader);
    var version = readUint32(reader);
    if (size !== 58 && size !== 78)
        throw new Error("Invalid effects bevel info size: " + size);
    if (version !== 0 && version !== 2)
        throw new Error("Invalid effects bevel info version: " + version);
    var angle = readUint32(reader);
    var strength = readUint32(reader);
    var blur = readUint32(reader);
    var highlightBlendMode = readBlendMode(reader);
    var shadowBlendMode = readBlendMode(reader);
    var highlightColor = readColor(reader);
    var shadowColor = readColor(reader);
    var bevelStyle = readUint8(reader);
    var highlightOpacity = readUint8(reader);
    var shadowOpacity = readUint8(reader);
    var enabled = !!readUint8(reader);
    var useAngleInAllEffects = !!readUint8(reader);
    var up = !!readUint8(reader);
    var realHighlightColor = size >= 78 ? readColor(reader) : undefined;
    var realShadowColor = size >= 78 ? readColor(reader) : undefined;
    return {
        angle: angle, strength: strength, blur: blur, highlightBlendMode: highlightBlendMode, shadowBlendMode: shadowBlendMode, highlightColor: highlightColor, shadowColor: shadowColor,
        bevelStyle: bevelStyle, highlightOpacity: highlightOpacity, shadowOpacity: shadowOpacity, enabled: enabled, useAngleInAllEffects: useAngleInAllEffects, up: up,
        realHighlightColor: realHighlightColor, realShadowColor: realShadowColor
    };
}
function readSolidFillInfo(reader) {
    var size = readUint32(reader);
    var version = readUint32(reader);
    if (size !== 34)
        throw new Error("Invalid effects solid fill info size: " + size);
    if (version !== 2)
        throw new Error("Invalid effects solid fill info version: " + version);
    var blendMode = readBlendMode(reader);
    var color = readColor(reader);
    var opacity = readUint8(reader);
    var enabled = !!readUint8(reader);
    var nativeColor = readColor(reader);
    return { blendMode: blendMode, color: color, opacity: opacity, enabled: enabled, nativeColor: nativeColor };
}
export function readEffects(reader) {
    var version = readUint16(reader);
    if (version !== 0)
        throw new Error("Invalid effects layer version: " + version);
    var effectsCount = readUint16(reader);
    var effects = {};
    for (var i = 0; i < effectsCount; i++) {
        checkSignature(reader, '8BIM');
        var type = readSignature(reader);
        switch (type) {
            case 'cmnS': // common state (see See Effects layer, common state info)
                var size = readUint32(reader);
                var version_1 = readUint32(reader);
                var visible = !!readUint8(reader);
                skipBytes(reader, 2);
                if (size !== 7 || version_1 !== 0 || !visible)
                    throw new Error("Invalid effects common state");
                break;
            case 'dsdw': // drop shadow (see See Effects layer, drop shadow and inner shadow info)
                effects.dropShadow = readShadowInfo(reader);
                break;
            case 'isdw': // inner shadow (see See Effects layer, drop shadow and inner shadow info)
                effects.innerShadow = readShadowInfo(reader);
                break;
            case 'oglw': // outer glow (see See Effects layer, outer glow info)
                effects.outerGlow = readOuterGlowInfo(reader);
                break;
            case 'iglw': // inner glow (see See Effects layer, inner glow info)
                effects.innerGlow = readInnerGlowInfo(reader);
                break;
            case 'bevl': // bevel (see See Effects layer, bevel info)
                effects.bevel = readBevelInfo(reader);
                break;
            case 'sofi': // solid fill ( Photoshop 7.0) (see See Effects layer, solid fill (added in Photoshop 7.0))
                effects.solidFill = readSolidFillInfo(reader);
                break;
            default:
                throw new Error("Invalid effect type: '" + type + "'");
        }
    }
    return effects;
}
export function writeEffects(_writer, _effects) {
    throw new Error('Not implemented');
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QyxLQUFLLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUN0QyxNQUFNO1lBQ1AsS0FBSyxNQUFNLEVBQUUsMkZBQTJGO2dCQUN2RyxPQUFPLENBQUMsU0FBUyxHQUFHLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUM5QyxNQUFNO1lBQ1A7Z0JBQ0MsTUFBTSxJQUFJLEtBQUssQ0FBQywyQkFBeUIsSUFBSSxNQUFHLENBQUMsQ0FBQztTQUNuRDtLQUNEO0lBRUQsT0FBTyxPQUFPLENBQUM7QUFDaEIsQ0FBQztBQUVELE1BQU0sVUFBVSxZQUFZLENBQUMsT0FBa0IsRUFBRSxRQUEwQjtJQUMxRSxNQUFNLElBQUksS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUM7QUFDcEMsQ0FBQyIsImZpbGUiOiJlZmZlY3RzSGVscGVycy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG5cdExheWVyRWZmZWN0c0luZm8sIExheWVyRWZmZWN0c0JldmVsSW5mbywgTGF5ZXJFZmZlY3RzSW5uZXJHbG93SW5mbywgTGF5ZXJFZmZlY3RzT3V0ZXJHbG93SW5mbyxcblx0TGF5ZXJFZmZlY3RzU2hhZG93SW5mbywgTGF5ZXJFZmZlY3RzU29saWRGaWxsSW5mb1xufSBmcm9tICcuL3BzZCc7XG5pbXBvcnQgeyByZWFkQ29sb3IgfSBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0IHsgUHNkUmVhZGVyLCBjaGVja1NpZ25hdHVyZSwgcmVhZFNpZ25hdHVyZSwgc2tpcEJ5dGVzLCByZWFkVWludDE2LCByZWFkVWludDgsIHJlYWRVaW50MzIsIHJlYWRJbnQzMiB9IGZyb20gJy4vcHNkUmVhZGVyJztcbmltcG9ydCB7IFBzZFdyaXRlciB9IGZyb20gJy4vcHNkV3JpdGVyJztcblxuZnVuY3Rpb24gcmVhZEJsZW5kTW9kZShyZWFkZXI6IFBzZFJlYWRlcikge1xuXHRjaGVja1NpZ25hdHVyZShyZWFkZXIsICc4QklNJyk7XG5cdHJldHVybiByZWFkU2lnbmF0dXJlKHJlYWRlcik7XG59XG5cbmZ1bmN0aW9uIHJlYWRTaGFkb3dJbmZvKHJlYWRlcjogUHNkUmVhZGVyKTogTGF5ZXJFZmZlY3RzU2hhZG93SW5mbyB7XG5cdGNvbnN0IHNpemUgPSByZWFkVWludDMyKHJlYWRlcik7XG5cdGNvbnN0IHZlcnNpb24gPSByZWFkVWludDMyKHJlYWRlcik7XG5cblx0aWYgKHNpemUgIT09IDQxICYmIHNpemUgIT09IDUxKVxuXHRcdHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBlZmZlY3RzIHNoYWRvdyBpbmZvIHNpemU6ICR7c2l6ZX1gKTtcblxuXHRpZiAodmVyc2lvbiAhPT0gMCAmJiB2ZXJzaW9uICE9PSAyKVxuXHRcdHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBlZmZlY3RzIHNoYWRvdyBpbmZvIHZlcnNpb246ICR7dmVyc2lvbn1gKTtcblxuXHRjb25zdCBibHVyID0gcmVhZEludDMyKHJlYWRlcik7XG5cdGNvbnN0IGludGVuc2l0eSA9IHJlYWRJbnQzMihyZWFkZXIpO1xuXHRjb25zdCBhbmdsZSA9IHJlYWRJbnQzMihyZWFkZXIpO1xuXHRjb25zdCBkaXN0YW5jZSA9IHJlYWRJbnQzMihyZWFkZXIpO1xuXHRjb25zdCBjb2xvciA9IHJlYWRDb2xvcihyZWFkZXIpO1xuXHRjb25zdCBibGVuZE1vZGUgPSByZWFkQmxlbmRNb2RlKHJlYWRlcik7XG5cdGNvbnN0IGVuYWJsZWQgPSAhIXJlYWRVaW50OChyZWFkZXIpO1xuXHRjb25zdCB1c2VBbmdsZUluQWxsRWZmZWN0cyA9ICEhcmVhZFVpbnQ4KHJlYWRlcik7XG5cdGNvbnN0IG9wYWNpdHkgPSByZWFkVWludDgocmVhZGVyKTtcblx0Y29uc3QgbmF0aXZlQ29sb3IgPSBzaXplID49IDUxID8gcmVhZENvbG9yKHJlYWRlcikgOiB1bmRlZmluZWQ7XG5cblx0cmV0dXJuIHsgYmx1ciwgaW50ZW5zaXR5LCBhbmdsZSwgZGlzdGFuY2UsIGNvbG9yLCBibGVuZE1vZGUsIGVuYWJsZWQsIHVzZUFuZ2xlSW5BbGxFZmZlY3RzLCBvcGFjaXR5LCBuYXRpdmVDb2xvciB9O1xufVxuXG5mdW5jdGlvbiByZWFkT3V0ZXJHbG93SW5mbyhyZWFkZXI6IFBzZFJlYWRlcik6IExheWVyRWZmZWN0c091dGVyR2xvd0luZm8ge1xuXHRjb25zdCBzaXplID0gcmVhZFVpbnQzMihyZWFkZXIpO1xuXHRjb25zdCB2ZXJzaW9uID0gcmVhZFVpbnQzMihyZWFkZXIpO1xuXG5cdGlmIChzaXplICE9PSAzMiAmJiBzaXplICE9PSA0Milcblx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZWZmZWN0cyBvdXRlciBnbG93IGluZm8gc2l6ZTogJHtzaXplfWApO1xuXG5cdGlmICh2ZXJzaW9uICE9PSAwICYmIHZlcnNpb24gIT09IDIpXG5cdFx0dGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGVmZmVjdHMgb3V0ZXIgZ2xvdyBpbmZvIHZlcnNpb246ICR7dmVyc2lvbn1gKTtcblxuXHRjb25zdCBibHVyID0gcmVhZFVpbnQzMihyZWFkZXIpO1xuXHRjb25zdCBpbnRlbnNpdHkgPSByZWFkVWludDMyKHJlYWRlcik7XG5cdGNvbnN0IGNvbG9yID0gcmVhZENvbG9yKHJlYWRlcik7XG5cdGNvbnN0IGJsZW5kTW9kZSA9IHJlYWRCbGVuZE1vZGUocmVhZGVyKTtcblx0Y29uc3QgZW5hYmxlZCA9ICEhcmVhZFVpbnQ4KHJlYWRlcik7XG5cdGNvbnN0IG9wYWNpdHkgPSByZWFkVWludDgocmVhZGVyKTtcblx0Y29uc3QgbmF0aXZlQ29sb3IgPSBzaXplID49IDQyID8gcmVhZENvbG9yKHJlYWRlcikgOiB1bmRlZmluZWQ7XG5cblx0cmV0dXJuIHsgYmx1ciwgaW50ZW5zaXR5LCBjb2xvciwgYmxlbmRNb2RlLCBlbmFibGVkLCBvcGFjaXR5LCBuYXRpdmVDb2xvciB9O1xufVxuXG5mdW5jdGlvbiByZWFkSW5uZXJHbG93SW5mbyhyZWFkZXI6IFBzZFJlYWRlcik6IExheWVyRWZmZWN0c0lubmVyR2xvd0luZm8ge1xuXHRjb25zdCBzaXplID0gcmVhZFVpbnQzMihyZWFkZXIpO1xuXHRjb25zdCB2ZXJzaW9uID0gcmVhZFVpbnQzMihyZWFkZXIpO1xuXG5cdGlmIChzaXplICE9PSAzMyAmJiBzaXplICE9PSA0Mylcblx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZWZmZWN0cyBpbm5lciBnbG93IGluZm8gc2l6ZTogJHtzaXplfWApO1xuXG5cdGlmICh2ZXJzaW9uICE9PSAwICYmIHZlcnNpb24gIT09IDIpXG5cdFx0dGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGVmZmVjdHMgaW5uZXIgZ2xvdyBpbmZvIHZlcnNpb246ICR7dmVyc2lvbn1gKTtcblxuXHRjb25zdCBibHVyID0gcmVhZFVpbnQzMihyZWFkZXIpO1xuXHRjb25zdCBpbnRlbnNpdHkgPSByZWFkVWludDMyKHJlYWRlcik7XG5cdGNvbnN0IGNvbG9yID0gcmVhZENvbG9yKHJlYWRlcik7XG5cdGNvbnN0IGJsZW5kTW9kZSA9IHJlYWRCbGVuZE1vZGUocmVhZGVyKTtcblx0Y29uc3QgZW5hYmxlZCA9ICEhcmVhZFVpbnQ4KHJlYWRlcik7XG5cdGNvbnN0IG9wYWNpdHkgPSByZWFkVWludDgocmVhZGVyKTtcblxuXHRjb25zdCBpbnZlcnQgPSBzaXplID49IDQzID8gISFyZWFkVWludDgocmVhZGVyKSA6IHVuZGVmaW5lZDtcblx0Y29uc3QgbmF0aXZlQ29sb3IgPSBzaXplID49IDQzID8gcmVhZENvbG9yKHJlYWRlcikgOiB1bmRlZmluZWQ7XG5cblx0cmV0dXJuIHsgYmx1ciwgaW50ZW5zaXR5LCBjb2xvciwgYmxlbmRNb2RlLCBlbmFibGVkLCBvcGFjaXR5LCBpbnZlcnQsIG5hdGl2ZUNvbG9yIH07XG59XG5cbmZ1bmN0aW9uIHJlYWRCZXZlbEluZm8ocmVhZGVyOiBQc2RSZWFkZXIpOiBMYXllckVmZmVjdHNCZXZlbEluZm8ge1xuXHRjb25zdCBzaXplID0gcmVhZFVpbnQzMihyZWFkZXIpO1xuXHRjb25zdCB2ZXJzaW9uID0gcmVhZFVpbnQzMihyZWFkZXIpO1xuXG5cdGlmIChzaXplICE9PSA1OCAmJiBzaXplICE9PSA3OClcblx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZWZmZWN0cyBiZXZlbCBpbmZvIHNpemU6ICR7c2l6ZX1gKTtcblxuXHRpZiAodmVyc2lvbiAhPT0gMCAmJiB2ZXJzaW9uICE9PSAyKVxuXHRcdHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBlZmZlY3RzIGJldmVsIGluZm8gdmVyc2lvbjogJHt2ZXJzaW9ufWApO1xuXG5cdGNvbnN0IGFuZ2xlID0gcmVhZFVpbnQzMihyZWFkZXIpO1xuXHRjb25zdCBzdHJlbmd0aCA9IHJlYWRVaW50MzIocmVhZGVyKTtcblx0Y29uc3QgYmx1ciA9IHJlYWRVaW50MzIocmVhZGVyKTtcblx0Y29uc3QgaGlnaGxpZ2h0QmxlbmRNb2RlID0gcmVhZEJsZW5kTW9kZShyZWFkZXIpO1xuXHRjb25zdCBzaGFkb3dCbGVuZE1vZGUgPSByZWFkQmxlbmRNb2RlKHJlYWRlcik7XG5cdGNvbnN0IGhpZ2hsaWdodENvbG9yID0gcmVhZENvbG9yKHJlYWRlcik7XG5cdGNvbnN0IHNoYWRvd0NvbG9yID0gcmVhZENvbG9yKHJlYWRlcik7XG5cdGNvbnN0IGJldmVsU3R5bGUgPSByZWFkVWludDgocmVhZGVyKTtcblx0Y29uc3QgaGlnaGxpZ2h0T3BhY2l0eSA9IHJlYWRVaW50OChyZWFkZXIpO1xuXHRjb25zdCBzaGFkb3dPcGFjaXR5ID0gcmVhZFVpbnQ4KHJlYWRlcik7XG5cdGNvbnN0IGVuYWJsZWQgPSAhIXJlYWRVaW50OChyZWFkZXIpO1xuXHRjb25zdCB1c2VBbmdsZUluQWxsRWZmZWN0cyA9ICEhcmVhZFVpbnQ4KHJlYWRlcik7XG5cdGNvbnN0IHVwID0gISFyZWFkVWludDgocmVhZGVyKTtcblxuXHRjb25zdCByZWFsSGlnaGxpZ2h0Q29sb3IgPSBzaXplID49IDc4ID8gcmVhZENvbG9yKHJlYWRlcikgOiB1bmRlZmluZWQ7XG5cdGNvbnN0IHJlYWxTaGFkb3dDb2xvciA9IHNpemUgPj0gNzggPyByZWFkQ29sb3IocmVhZGVyKSA6IHVuZGVmaW5lZDtcblxuXHRyZXR1cm4ge1xuXHRcdGFuZ2xlLCBzdHJlbmd0aCwgYmx1ciwgaGlnaGxpZ2h0QmxlbmRNb2RlLCBzaGFkb3dCbGVuZE1vZGUsIGhpZ2hsaWdodENvbG9yLCBzaGFkb3dDb2xvcixcblx0XHRiZXZlbFN0eWxlLCBoaWdobGlnaHRPcGFjaXR5LCBzaGFkb3dPcGFjaXR5LCBlbmFibGVkLCB1c2VBbmdsZUluQWxsRWZmZWN0cywgdXAsXG5cdFx0cmVhbEhpZ2hsaWdodENvbG9yLCByZWFsU2hhZG93Q29sb3Jcblx0fTtcbn1cblxuZnVuY3Rpb24gcmVhZFNvbGlkRmlsbEluZm8ocmVhZGVyOiBQc2RSZWFkZXIpOiBMYXllckVmZmVjdHNTb2xpZEZpbGxJbmZvIHtcblx0Y29uc3Qgc2l6ZSA9IHJlYWRVaW50MzIocmVhZGVyKTtcblx0Y29uc3QgdmVyc2lvbiA9IHJlYWRVaW50MzIocmVhZGVyKTtcblxuXHRpZiAoc2l6ZSAhPT0gMzQpXG5cdFx0dGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGVmZmVjdHMgc29saWQgZmlsbCBpbmZvIHNpemU6ICR7c2l6ZX1gKTtcblxuXHRpZiAodmVyc2lvbiAhPT0gMilcblx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZWZmZWN0cyBzb2xpZCBmaWxsIGluZm8gdmVyc2lvbjogJHt2ZXJzaW9ufWApO1xuXG5cdGNvbnN0IGJsZW5kTW9kZSA9IHJlYWRCbGVuZE1vZGUocmVhZGVyKTtcblx0Y29uc3QgY29sb3IgPSByZWFkQ29sb3IocmVhZGVyKTtcblx0Y29uc3Qgb3BhY2l0eSA9IHJlYWRVaW50OChyZWFkZXIpO1xuXHRjb25zdCBlbmFibGVkID0gISFyZWFkVWludDgocmVhZGVyKTtcblx0Y29uc3QgbmF0aXZlQ29sb3IgPSByZWFkQ29sb3IocmVhZGVyKTtcblxuXHRyZXR1cm4geyBibGVuZE1vZGUsIGNvbG9yLCBvcGFjaXR5LCBlbmFibGVkLCBuYXRpdmVDb2xvciB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVhZEVmZmVjdHMocmVhZGVyOiBQc2RSZWFkZXIpIHtcblx0Y29uc3QgdmVyc2lvbiA9IHJlYWRVaW50MTYocmVhZGVyKTtcblxuXHRpZiAodmVyc2lvbiAhPT0gMClcblx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZWZmZWN0cyBsYXllciB2ZXJzaW9uOiAke3ZlcnNpb259YCk7XG5cblx0Y29uc3QgZWZmZWN0c0NvdW50ID0gcmVhZFVpbnQxNihyZWFkZXIpO1xuXHRjb25zdCBlZmZlY3RzOiBMYXllckVmZmVjdHNJbmZvID0gPGFueT57fTtcblxuXHRmb3IgKGxldCBpID0gMDsgaSA8IGVmZmVjdHNDb3VudDsgaSsrKSB7XG5cdFx0Y2hlY2tTaWduYXR1cmUocmVhZGVyLCAnOEJJTScpO1xuXHRcdGNvbnN0IHR5cGUgPSByZWFkU2lnbmF0dXJlKHJlYWRlcik7XG5cblx0XHRzd2l0Y2ggKHR5cGUpIHtcblx0XHRcdGNhc2UgJ2NtblMnOiAvLyBjb21tb24gc3RhdGUgKHNlZSBTZWUgRWZmZWN0cyBsYXllciwgY29tbW9uIHN0YXRlIGluZm8pXG5cdFx0XHRcdGNvbnN0IHNpemUgPSByZWFkVWludDMyKHJlYWRlcik7XG5cdFx0XHRcdGNvbnN0IHZlcnNpb24gPSByZWFkVWludDMyKHJlYWRlcik7XG5cdFx0XHRcdGNvbnN0IHZpc2libGUgPSAhIXJlYWRVaW50OChyZWFkZXIpO1xuXHRcdFx0XHRza2lwQnl0ZXMocmVhZGVyLCAyKTtcblxuXHRcdFx0XHRpZiAoc2l6ZSAhPT0gNyB8fCB2ZXJzaW9uICE9PSAwIHx8ICF2aXNpYmxlKVxuXHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBlZmZlY3RzIGNvbW1vbiBzdGF0ZWApO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJ2RzZHcnOiAvLyBkcm9wIHNoYWRvdyAoc2VlIFNlZSBFZmZlY3RzIGxheWVyLCBkcm9wIHNoYWRvdyBhbmQgaW5uZXIgc2hhZG93IGluZm8pXG5cdFx0XHRcdGVmZmVjdHMuZHJvcFNoYWRvdyA9IHJlYWRTaGFkb3dJbmZvKHJlYWRlcik7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnaXNkdyc6IC8vIGlubmVyIHNoYWRvdyAoc2VlIFNlZSBFZmZlY3RzIGxheWVyLCBkcm9wIHNoYWRvdyBhbmQgaW5uZXIgc2hhZG93IGluZm8pXG5cdFx0XHRcdGVmZmVjdHMuaW5uZXJTaGFkb3cgPSByZWFkU2hhZG93SW5mbyhyZWFkZXIpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJ29nbHcnOiAvLyBvdXRlciBnbG93IChzZWUgU2VlIEVmZmVjdHMgbGF5ZXIsIG91dGVyIGdsb3cgaW5mbylcblx0XHRcdFx0ZWZmZWN0cy5vdXRlckdsb3cgPSByZWFkT3V0ZXJHbG93SW5mbyhyZWFkZXIpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJ2lnbHcnOiAvLyBpbm5lciBnbG93IChzZWUgU2VlIEVmZmVjdHMgbGF5ZXIsIGlubmVyIGdsb3cgaW5mbylcblx0XHRcdFx0ZWZmZWN0cy5pbm5lckdsb3cgPSByZWFkSW5uZXJHbG93SW5mbyhyZWFkZXIpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJ2JldmwnOiAvLyBiZXZlbCAoc2VlIFNlZSBFZmZlY3RzIGxheWVyLCBiZXZlbCBpbmZvKVxuXHRcdFx0XHRlZmZlY3RzLmJldmVsID0gcmVhZEJldmVsSW5mbyhyZWFkZXIpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJ3NvZmknOiAvLyBzb2xpZCBmaWxsICggUGhvdG9zaG9wIDcuMCkgKHNlZSBTZWUgRWZmZWN0cyBsYXllciwgc29saWQgZmlsbCAoYWRkZWQgaW4gUGhvdG9zaG9wIDcuMCkpXG5cdFx0XHRcdGVmZmVjdHMuc29saWRGaWxsID0gcmVhZFNvbGlkRmlsbEluZm8ocmVhZGVyKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgZWZmZWN0IHR5cGU6ICcke3R5cGV9J2ApO1xuXHRcdH1cblx0fVxuXG5cdHJldHVybiBlZmZlY3RzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gd3JpdGVFZmZlY3RzKF93cml0ZXI6IFBzZFdyaXRlciwgX2VmZmVjdHM6IExheWVyRWZmZWN0c0luZm8pIHtcblx0dGhyb3cgbmV3IEVycm9yKCdOb3QgaW1wbGVtZW50ZWQnKTtcbn1cbiJdLCJzb3VyY2VSb290IjoiRDpcXFByb2plY3RzXFxnaXRodWJcXGFnLXBzZFxcc3JjIn0=
