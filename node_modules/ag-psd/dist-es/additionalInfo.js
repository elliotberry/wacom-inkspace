import { readEffects, writeEffects } from './effectsHelpers';
import { readColor, toArray } from './helpers';
import { readSignature, readUnicodeString, skipBytes, readUint32, readUint8, readFloat64, readUint16, readBytes, readAsciiString, readInt32, readFloat32, readInt32LE, readUnicodeStringWithLength } from './psdReader';
import { writeZeros, writeUnicodeString, writeSignature, writeBytes, writeUint32, writeUint16, writeFloat64, writeUint8 } from './psdWriter';
var handlers = [];
var handlersMap = {};
function addHandler(key, has, read, write) {
    var handler = { key: key, has: has, read: read, write: write };
    handlers.push(handler);
    handlersMap[handler.key] = handler;
}
export function getHandler(key) {
    return handlersMap[key];
}
export function getHandlers() {
    return handlers;
}
addHandler('luni', function (target) { return typeof target.name !== 'undefined'; }, function (reader, target, left) {
    target.name = readUnicodeString(reader);
    skipBytes(reader, left()); // TEMP: skipping
}, function (writer, target) {
    writeUnicodeString(writer, target.name);
});
addHandler('lnsr', function (target) { return typeof target.nameSource !== 'undefined'; }, function (reader, target) { return target.nameSource = readSignature(reader); }, function (writer, target) { return writeSignature(writer, target.nameSource); });
addHandler('lyid', function (target) { return typeof target.id !== 'undefined'; }, function (reader, target) { return target.id = readUint32(reader); }, function (writer, target) { return writeUint32(writer, target.id); });
addHandler('clbl', function (target) { return typeof target.blendClippendElements !== 'undefined'; }, function (reader, target) {
    target.blendClippendElements = !!readUint8(reader);
    skipBytes(reader, 3);
}, function (writer, target) {
    writeUint8(writer, target.blendClippendElements ? 1 : 0);
    writeZeros(writer, 3);
});
addHandler('infx', function (target) { return typeof target.blendInteriorElements !== 'undefined'; }, function (reader, target) {
    target.blendInteriorElements = !!readUint8(reader);
    skipBytes(reader, 3);
}, function (writer, target) {
    writeUint8(writer, target.blendInteriorElements ? 1 : 0);
    writeZeros(writer, 3);
});
addHandler('knko', function (target) { return typeof target.knockout !== 'undefined'; }, function (reader, target) {
    target.knockout = !!readUint8(reader);
    skipBytes(reader, 3);
}, function (writer, target) {
    writeUint8(writer, target.knockout ? 1 : 0);
    writeZeros(writer, 3);
});
addHandler('lspf', function (target) { return typeof target.protected !== 'undefined'; }, function (reader, target) {
    var flags = readUint32(reader);
    target.protected = {
        transparency: (flags & 0x01) !== 0,
        composite: (flags & 0x02) !== 0,
        position: (flags & 0x04) !== 0,
    };
}, function (writer, target) {
    var flags = (target.protected.transparency ? 0x01 : 0) |
        (target.protected.composite ? 0x02 : 0) |
        (target.protected.position ? 0x04 : 0);
    writeUint32(writer, flags);
});
addHandler('lclr', function (target) { return typeof target.sheetColors !== 'undefined'; }, function (reader, target) {
    target.sheetColors = {
        color1: readUint32(reader),
        color2: readUint32(reader),
    };
}, function (writer, target) {
    writeUint32(writer, target.sheetColors.color1);
    writeUint32(writer, target.sheetColors.color2);
});
addHandler('fxrp', function (target) { return typeof target.referencePoint !== 'undefined'; }, function (reader, target) {
    target.referencePoint = {
        x: readFloat64(reader),
        y: readFloat64(reader),
    };
}, function (writer, target) {
    writeFloat64(writer, target.referencePoint.x);
    writeFloat64(writer, target.referencePoint.y);
});
addHandler('lsct', function (target) { return typeof target.sectionDivider !== 'undefined'; }, function (reader, target, left) {
    var item = {};
    item.type = readUint32(reader);
    if (left()) {
        var signature = readSignature(reader);
        if (signature !== '8BIM')
            throw new Error("Invalid signature: '" + signature + "'");
        item.key = readSignature(reader);
    }
    if (left()) {
        // 0 = normal
        // 1 = scene group, affects the animation timeline.
        item.subType = readUint32(reader);
    }
    target.sectionDivider = item;
}, function (writer, target) {
    writeUint32(writer, target.sectionDivider.type);
    if (target.sectionDivider.key) {
        writeSignature(writer, '8BIM');
        writeSignature(writer, target.sectionDivider.key);
        if (typeof target.sectionDivider.subtype !== 'undefined')
            writeUint32(writer, target.sectionDivider.subtype);
    }
});
addHandler('FMsk', function (target) { return typeof target.filterMask !== 'undefined'; }, function (reader, target) {
    target.filterMask = {
        colorSpace: readColor(reader),
        opacity: readUint16(reader),
    };
}, function (writer, target) {
    writeBytes(writer, new Uint8Array(target.filterMask.colorSpace));
    writeUint16(writer, target.filterMask.opacity);
});
addHandler('shmd', function (target) { return typeof target.metadata !== 'undefined'; }, function (reader, target) {
    var count = readUint32(reader);
    target.metadata = [];
    for (var i = 0; i < count; i++) {
        var signature = readSignature(reader);
        if (signature !== '8BIM')
            throw new Error("Invalid signature: '" + signature + "'");
        var key = readSignature(reader);
        var copy = !!readUint8(reader);
        skipBytes(reader, 3);
        var length_1 = readUint32(reader);
        var data = toArray(readBytes(reader, length_1));
        target.metadata.push({ key: key, copy: copy, data: data });
    }
}, function (writer, target) {
    writeUint32(writer, target.metadata.length);
    for (var i = 0; i < target.metadata.length; i++) {
        var item = target.metadata[i];
        writeSignature(writer, '8BIM');
        writeSignature(writer, item.key);
        writeUint8(writer, item.copy ? 1 : 0);
        writeZeros(writer, 3);
        writeUint32(writer, item.data.length);
        writeBytes(writer, new Uint8Array(item.data));
    }
});
addHandler('lyvr', function (target) { return typeof target.version !== 'undefined'; }, function (reader, target) {
    target.version = readUint32(reader);
}, function (writer, target) {
    writeUint32(writer, target.version);
});
addHandler('lrFX', function (target) { return typeof target.effects !== 'undefined'; }, function (reader, target, left) {
    target.effects = readEffects(reader);
    skipBytes(reader, left()); // TEMP: skipping
}, function (writer, target) {
    writeEffects(writer, target.effects);
});
/*
addHandler(
    'TySh',
    _target => false, // typeof target.effects !== 'undefined',
    (reader, target) => {
        const version = readInt16(reader);

        if (version !== 1) {
            throw new Error(`Invalid TySh version: ${version}`);
        }

        const transform = [
            readFloat64(reader),
            readFloat64(reader),
            readFloat64(reader),
            readFloat64(reader),
            readFloat64(reader),
            readFloat64(reader),
        ];

        const textVersion = readInt16(reader);
        const descriptorVersion = readInt32(reader);

        if (textVersion !== 50 || descriptorVersion !== 16) {
            throw new Error(`Invalid TySh text version: ${textVersion}/${descriptorVersion}`);
        }

        const text = readDescriptorStructure(reader);

        // console.log('EngineData:', parseEngineData(text.EngineData));

        const warpVersion = readInt16(reader);
        const warpDescriptorVersion = readInt32(reader);

        if (warpVersion !== 1 || warpDescriptorVersion !== 16) {
            throw new Error(`Invalid TySh warp version: ${warpVersion} ${warpDescriptorVersion}`);
        }

        const warp = readDescriptorStructure(reader);

        const left = readInt32(reader);
        const top = readInt32(reader);
        const right = readInt32(reader);
        const bottom = readInt32(reader);

        target.typeToolObjectSetting = { transform, text, warp, left, top, right, bottom };
    },
    (_writer, _target) => {
        throw new Error('not implemented');
    },
);

addHandler(
    'Txt2',
    target => typeof target.textEngineData !== 'undefined',
    (reader, target, left) => {
        target.textEngineData = Array.from(readBytes(reader, left()));
    },
    (writer, target) => {
        writeBytes(writer, new Uint8Array(target.textEngineData!));
    },
);
*/
addHandler('lfx2', function (target) { return typeof target.objectBasedEffectsLayerInfo !== 'undefined'; }, function (reader, _target, left) {
    skipBytes(reader, left());
    // const version = readUint32(reader);
    // const descriptorVersion = readUint32(reader);
    // const name = reader.readUnicodeString();
    // const classId = readStringOrClassId(reader);
    // const itemsCount = readUint32(reader);
    //for (let i = 0; i < itemsCount; i++) {
    //	console.log('read item');
    //	const key = readStringOrClassId(reader);
    //	console.log('key', [key]);
    //}
    //target.objectBasedEffectsLayerInfo = {
    //	version,
    //	descriptorVersion,
    //	descriptor: {
    //		name,
    //		classId,
    //		//...
    //	},
    //};
}, function (_writer, _target) {
    //...
});
// Helpers
function readAsciiStringOrClassId(reader) {
    var length = readInt32(reader);
    return length === 0 ? readSignature(reader) : readAsciiString(reader, length);
}
function readDescriptorStructure(reader) {
    readClassStructure(reader);
    var itemsCount = readUint32(reader);
    var object = {};
    for (var i = 0; i < itemsCount; i++) {
        var key = readAsciiStringOrClassId(reader);
        var type = readSignature(reader);
        var data = readOSType(reader, type);
        object[key] = data;
    }
    return object;
}
function readOSType(reader, type) {
    switch (type) {
        case 'obj ': // Reference
            return readReferenceStructure(reader);
        case 'Objc': // Descriptor
        case 'GlbO': // GlobalObject same as Descriptor
            return readDescriptorStructure(reader);
        case 'VlLs': // List
            return readListStructure(reader);
        case 'doub': // Double
            return readFloat64(reader);
        case 'UntF': // Unit double
            return readUnitDoubleStructure(reader);
        case 'UnFl': // Unit float
            return readUnitFloatStructure(reader);
        case 'TEXT': // String
            return readUnicodeString(reader);
        case 'enum': // Enumerated
            return readEnumerated(reader);
        case 'long': // Integer
            return readInt32(reader);
        case 'comp': // Large Integer
            return readLargeInteger(reader);
        case 'bool': // Boolean
            return !!readUint8(reader);
        case 'type': // Class
        case 'GlbC': // Class
            return readClassStructure(reader);
        case 'alis': // Alias
            return readAliasStructure(reader);
        case 'tdta': // Raw Data
            return readRawData(reader);
        case 'ObAr': // Object array
            throw new Error('not implemented: ObAr');
        case 'Pth ': // File path
            return readFilePath(reader);
        default:
            throw new Error("Invalid TySh descriptor OSType: " + type + " at " + reader.offset.toString(16));
    }
}
function readReferenceStructure(reader) {
    var itemsCount = readInt32(reader);
    var items = [];
    for (var i = 0; i < itemsCount; i++) {
        var type = readSignature(reader);
        switch (type) {
            case 'prop': // Property
                items.push(readPropertyStructure(reader));
                break;
            case 'Clss': // Class
                items.push(readClassStructure(reader));
                break;
            case 'Enmr': // Enumerated Reference
                items.push(readEnumeratedReference(reader));
                break;
            case 'rele': // Offset
                items.push(readOffsetStructure(reader));
                break;
            case 'Idnt': // Identifier
                items.push(readInt32(reader));
                break;
            case 'indx': // Index
                items.push(readInt32(reader));
                break;
            case 'name': // Name
                items.push(readUnicodeString(reader));
                break;
            default:
                throw new Error("Invalid TySh descriptor Reference type: " + type);
        }
    }
    return items;
}
function readPropertyStructure(reader) {
    var _a = readClassStructure(reader), name = _a.name, classID = _a.classID;
    var keyID = readAsciiStringOrClassId(reader);
    return { name: name, classID: classID, keyID: keyID };
}
var unitsMap = {
    '#Ang': 'Angle',
    '#Rsl': 'Density',
    '#Rlt': 'Distance',
    '#Nne': 'None',
    '#Prc': 'Percent',
    '#Pxl': 'Pixels',
    '#Mlm': 'Millimeters',
    '#Pnt': 'Points',
};
function readUnitDoubleStructure(reader) {
    var units = readSignature(reader);
    var value = readFloat64(reader);
    return { units: unitsMap[units], value: value };
}
function readUnitFloatStructure(reader) {
    var units = readSignature(reader);
    var value = readFloat32(reader);
    return { units: unitsMap[units], value: value };
}
function readClassStructure(reader) {
    var name = readUnicodeString(reader);
    var classID = readAsciiStringOrClassId(reader);
    return { name: name, classID: classID };
}
function readEnumeratedReference(reader) {
    var _a = readClassStructure(reader), name = _a.name, classID = _a.classID;
    var TypeID = readAsciiStringOrClassId(reader);
    var value = readAsciiStringOrClassId(reader);
    return { name: name, classID: classID, TypeID: TypeID, value: value };
}
function readOffsetStructure(reader) {
    var _a = readClassStructure(reader), name = _a.name, classID = _a.classID;
    var value = readUint32(reader);
    return { name: name, classID: classID, value: value };
}
function readAliasStructure(reader) {
    var length = readInt32(reader);
    return readAsciiString(reader, length);
}
function readListStructure(reader) {
    var length = readInt32(reader);
    var type = readSignature(reader);
    var items = [];
    for (var i = 0; i < length; i++) {
        items.push(readOSType(reader, type));
    }
    return items;
}
function readLargeInteger(reader) {
    var low = readUint32(reader);
    var high = readUint32(reader);
    return { low: low, high: high };
}
function readEnumerated(reader) {
    var type = readAsciiStringOrClassId(reader);
    var value = readAsciiStringOrClassId(reader);
    return type + "." + value;
}
function readRawData(reader) {
    var length = readInt32(reader);
    return Array.from(readBytes(reader, length));
}
function readFilePath(reader) {
    var length = readInt32(reader);
    var sig = readSignature(reader);
    var pathSize = readInt32LE(reader);
    var charsCount = readInt32LE(reader);
    var path = readUnicodeStringWithLength(reader, charsCount);
    length;
    pathSize;
    return { sig: sig, path: path };
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFVLENBQ1QsTUFBTSxFQUNOLFVBQUEsTUFBTSxJQUFJLE9BQUEsT0FBTyxNQUFNLENBQUMscUJBQXFCLEtBQUssV0FBVyxFQUFuRCxDQUFtRCxFQUM3RCxVQUFDLE1BQU0sRUFBRSxNQUFNO0lBQ2QsTUFBTSxDQUFDLHFCQUFxQixHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbkQsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztBQUN0QixDQUFDLEVBQ0QsVUFBQyxNQUFNLEVBQUUsTUFBTTtJQUNkLFVBQVUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3pELFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDdkIsQ0FBQyxDQUNELENBQUM7QUFFRixVQUFVLENBQ1QsTUFBTSxFQUNOLFVBQUEsTUFBTSxJQUFJLE9BQUEsT0FBTyxNQUFNLENBQUMscUJBQXFCLEtBQUssV0FBVyxFQUFuRCxDQUFtRCxFQUM3RCxVQUFDLE1BQU0sRUFBRSxNQUFNO0lBQ2QsTUFBTSxDQUFDLHFCQUFxQixHQUFHLENBQUMsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbkQsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztBQUN0QixDQUFDLEVBQ0QsVUFBQyxNQUFNLEVBQUUsTUFBTTtJQUNkLFVBQVUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3pELFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDdkIsQ0FBQyxDQUNELENBQUM7QUFFRixVQUFVLENBQ1QsTUFBTSxFQUNOLFVBQUEsTUFBTSxJQUFJLE9BQUEsT0FBTyxNQUFNLENBQUMsUUFBUSxLQUFLLFdBQVcsRUFBdEMsQ0FBc0MsRUFDaEQsVUFBQyxNQUFNLEVBQUUsTUFBTTtJQUNkLE1BQU0sQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN0QyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQ3RCLENBQUMsRUFDRCxVQUFDLE1BQU0sRUFBRSxNQUFNO0lBQ2QsVUFBVSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzVDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDdkIsQ0FBQyxDQUNELENBQUM7QUFFRixVQUFVLENBQ1QsTUFBTSxFQUNOLFVBQUEsTUFBTSxJQUFJLE9BQUEsT0FBTyxNQUFNLENBQUMsU0FBUyxLQUFLLFdBQVcsRUFBdkMsQ0FBdUMsRUFDakQsVUFBQyxNQUFNLEVBQUUsTUFBTTtJQUNkLElBQU0sS0FBSyxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqQyxNQUFNLENBQUMsU0FBUyxHQUFHO1FBQ2xCLFlBQVksRUFBRSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQ2xDLFNBQVMsRUFBRSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQy9CLFFBQVEsRUFBRSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO0tBQzlCLENBQUM7QUFDSCxDQUFDLEVBQ0QsVUFBQyxNQUFNLEVBQUUsTUFBTTtJQUNkLElBQU0sS0FBSyxHQUNWLENBQUMsTUFBTSxDQUFDLFNBQVUsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNDLENBQUMsTUFBTSxDQUFDLFNBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hDLENBQUMsTUFBTSxDQUFDLFNBQVUsQ0FB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QUMvQyxPQUFVLElBQUksU0FBSSxLQUFPLENBQUM7QUFDM0IsQ0FBQztBQUVELFNBQVMsV0FBVyxDQUFDLE1BQWlCO0lBQ3JDLElBQU0sTUFBTSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqQyxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDO0FBQzlDLENBQUM7QUFFRCxTQUFTLFlBQVksQ0FBQyxNQUFpQjtJQUN0QyxJQUFNLE1BQU0sR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDakMsSUFBTSxHQUFHLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2xDLElBQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNyQyxJQUFNLFVBQVUsR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDdkMsSUFBTSxJQUFJLEdBQUcsMkJBQTJCLENBQUMsTUFBTSxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBRTdELE1BQU0sQ0FBQztJQUNQLFFBQVEsQ0FBQztJQUVULE9BQU8sRUFBRSxHQUFHLEtBQUEsRUFBRSxJQUFJLE1BQUEsRUFBRSxDQUFDO0FBQ3RCLENBQUMiLCJmaWxlIjoiYWRkaXRpb25hbEluZm8uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyByZWFkRWZmZWN0cywgd3JpdGVFZmZlY3RzIH0gZnJvbSAnLi9lZmZlY3RzSGVscGVycyc7XG5pbXBvcnQgeyByZWFkQ29sb3IsIHRvQXJyYXkgfSBmcm9tICcuL2hlbHBlcnMnO1xuaW1wb3J0IHsgTGF5ZXJBZGRpdGlvbmFsSW5mbyB9IGZyb20gJy4vcHNkJztcbmltcG9ydCB7XG5cdFBzZFJlYWRlciwgcmVhZFNpZ25hdHVyZSwgcmVhZFVuaWNvZGVTdHJpbmcsIHNraXBCeXRlcywgcmVhZFVpbnQzMiwgcmVhZFVpbnQ4LCByZWFkRmxvYXQ2NCwgcmVhZFVpbnQxNixcblx0cmVhZEJ5dGVzLCByZWFkQXNjaWlTdHJpbmcsIHJlYWRJbnQzMiwgcmVhZEZsb2F0MzIsIHJlYWRJbnQzMkxFLCByZWFkVW5pY29kZVN0cmluZ1dpdGhMZW5ndGhcbn0gZnJvbSAnLi9wc2RSZWFkZXInO1xuaW1wb3J0IHtcblx0UHNkV3JpdGVyLCB3cml0ZVplcm9zLCB3cml0ZVVuaWNvZGVTdHJpbmcsIHdyaXRlU2lnbmF0dXJlLCB3cml0ZUJ5dGVzLCB3cml0ZVVpbnQzMiwgd3JpdGVVaW50MTYsXG5cdHdyaXRlRmxvYXQ2NCwgd3JpdGVVaW50OFxufSBmcm9tICcuL3BzZFdyaXRlcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW5mb0hhbmRsZXIge1xuXHRrZXk6IHN0cmluZztcblx0aGFzOiAodGFyZ2V0OiBMYXllckFkZGl0aW9uYWxJbmZvKSA9PiBib29sZWFuO1xuXHRyZWFkOiAocmVhZGVyOiBQc2RSZWFkZXIsIHRhcmdldDogTGF5ZXJBZGRpdGlvbmFsSW5mbywgbGVmdDogKCkgPT4gbnVtYmVyKSA9PiB2b2lkO1xuXHR3cml0ZTogKHdyaXRlcjogUHNkV3JpdGVyLCB0YXJnZXQ6IExheWVyQWRkaXRpb25hbEluZm8pID0+IHZvaWQ7XG59XG5cbmNvbnN0IGhhbmRsZXJzOiBJbmZvSGFuZGxlcltdID0gW107XG5jb25zdCBoYW5kbGVyc01hcDogeyBba2V5OiBzdHJpbmddOiBJbmZvSGFuZGxlciB9ID0ge307XG5cbmZ1bmN0aW9uIGFkZEhhbmRsZXIoXG5cdGtleTogc3RyaW5nLFxuXHRoYXM6ICh0YXJnZXQ6IExheWVyQWRkaXRpb25hbEluZm8pID0+IGJvb2xlYW4sXG5cdHJlYWQ6IChyZWFkZXI6IFBzZFJlYWRlciwgdGFyZ2V0OiBMYXllckFkZGl0aW9uYWxJbmZvLCBsZWZ0OiAoKSA9PiBudW1iZXIpID0+IHZvaWQsXG5cdHdyaXRlOiAod3JpdGVyOiBQc2RXcml0ZXIsIHRhcmdldDogTGF5ZXJBZGRpdGlvbmFsSW5mbykgPT4gdm9pZCxcbikge1xuXHRjb25zdCBoYW5kbGVyOiBJbmZvSGFuZGxlciA9IHsga2V5LCBoYXMsIHJlYWQsIHdyaXRlIH07XG5cdGhhbmRsZXJzLnB1c2goaGFuZGxlcik7XG5cdGhhbmRsZXJzTWFwW2hhbmRsZXIua2V5XSA9IGhhbmRsZXI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRIYW5kbGVyKGtleTogc3RyaW5nKSB7XG5cdHJldHVybiBoYW5kbGVyc01hcFtrZXldO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0SGFuZGxlcnMoKSB7XG5cdHJldHVybiBoYW5kbGVycztcbn1cblxuYWRkSGFuZGxlcihcblx0J2x1bmknLFxuXHR0YXJnZXQgPT4gdHlwZW9mIHRhcmdldC5uYW1lICE9PSAndW5kZWZpbmVkJyxcblx0KHJlYWRlciwgdGFyZ2V0LCBsZWZ0KSA9PiB7XG5cdFx0dGFyZ2V0Lm5hbWUgPSByZWFkVW5pY29kZVN0cmluZyhyZWFkZXIpO1xuXHRcdHNraXBCeXRlcyhyZWFkZXIsIGxlZnQoKSk7IC8vIFRFTVA6IHNraXBwaW5nXG5cdH0sXG5cdCh3cml0ZXIsIHRhcmdldCkgPT4ge1xuXHRcdHdyaXRlVW5pY29kZVN0cmluZyh3cml0ZXIsIHRhcmdldC5uYW1lISk7XG5cdH1cbik7XG5cbmFkZEhhbmRsZXIoXG5cdCdsbnNyJyxcblx0dGFyZ2V0ID0+IHR5cGVvZiB0YXJnZXQubmFtZVNvdXJjZSAhPT0gJ3VuZGVmaW5lZCcsXG5cdChyZWFkZXIsIHRhcmdldCkgPT4gdGFyZ2V0Lm5hbWVTb3VyY2UgPSByZWFkU2lnbmF0dXJlKHJlYWRlciksXG5cdCh3cml0ZXIsIHRhcmdldCkgPT4gd3JpdGVTaWduYXR1cmUod3JpdGVyLCB0YXJnZXQubmFtZVNvdXJjZSEpLFxuKTtcblxuYWRkSGFuZGxlcihcblx0J2x5aWQnLFxuXHR0YXJnZXQgPT4gdHlwZW9mIHRhcmdldC5pZCAhPT0gJ3VuZGVmaW5lZCcsXG5cdChyZWFkZXIsIHRhcmdldCkgPT4gdGFyZ2V0LmlkID0gcmVhZFVpbnQzMihyZWFkZXIpLFxuXHQod3JpdGVyLCB0YXJnZXQpID0+IHdyaXRlVWludDMyKHdyaXRlciwgdGFyZ2V0LmlkISksXG4pO1xuXG5hZGRIYW5kbGVyKFxuXHQnY2xibCcsXG5cdHRhcmdldCA9PiB0eXBlb2YgdGFyZ2V0LmJsZW5kQ2xpcHBlbmRFbGVtZW50cyAhPT0gJ3VuZGVmaW5lZCcsXG5cdChyZWFkZXIsIHRhcmdldCkgPT4ge1xuXHRcdHRhcmdldC5ibGVuZENsaXBwZW5kRWxlbWVudHMgPSAhIXJlYWRVaW50OChyZWFkZXIpO1xuXHRcdHNraXBCeXRlcyhyZWFkZXIsIDMpO1xuXHR9LFxuXHQod3JpdGVyLCB0YXJnZXQpID0+IHtcblx0XHR3cml0ZVVpbnQ4KHdyaXRlciwgdGFyZ2V0LmJsZW5kQ2xpcHBlbmRFbGVtZW50cyA/IDEgOiAwKTtcblx0XHR3cml0ZVplcm9zKHdyaXRlciwgMyk7XG5cdH0sXG4pO1xuXG5hZGRIYW5kbGVyKFxuXHQnaW5meCcsXG5cdHRhcmdldCA9PiB0eXBlb2YgdGFyZ2V0LmJsZW5kSW50ZXJpb3JFbGVtZW50cyAhPT0gJ3VuZGVmaW5lZCcsXG5cdChyZWFkZXIsIHRhcmdldCkgPT4ge1xuXHRcdHRhcmdldC5ibGVuZEludGVyaW9yRWxlbWVudHMgPSAhIXJlYWRVaW50OChyZWFkZXIpO1xuXHRcdHNraXBCeXRlcyhyZWFkZXIsIDMpO1xuXHR9LFxuXHQod3JpdGVyLCB0YXJnZXQpID0+IHtcblx0XHR3cml0ZVVpbnQ4KHdyaXRlciwgdGFyZ2V0LmJsZW5kSW50ZXJpb3JFbGVtZW50cyA/IDEgOiAwKTtcblx0XHR3cml0ZVplcm9zKHdyaXRlciwgMyk7XG5cdH0sXG4pO1xuXG5hZGRIYW5kbGVyKFxuXHQna25rbycsXG5cdHRhcmdldCA9PiB0eXBlb2YgdGFyZ2V0Lmtub2Nrb3V0ICE9PSAndW5kZWZpbmVkJyxcblx0KHJlYWRlciwgdGFyZ2V0KSA9PiB7XG5cdFx0dGFyZ2V0Lmtub2Nrb3V0ID0gISFyZWFkVWludDgocmVhZGVyKTtcblx0XHRza2lwQnl0ZXMocmVhZGVyLCAzKTtcblx0fSxcblx0KHdyaXRlciwgdGFyZ2V0KSA9PiB7XG5cdFx0d3JpdGVVaW50OCh3cml0ZXIsIHRhcmdldC5rbm9ja291dCA/IDEgOiAwKTtcblx0XHR3cml0ZVplcm9zKHdyaXRlciwgMyk7XG5cdH0sXG4pO1xuXG5hZGRIYW5kbGVyKFxuXHQnbHNwZicsXG5cdHRhcmdldCA9PiB0eXBlb2YgdGFyZ2V0LnByb3RlY3RlZCAhPT0gJ3VuZGVmaW5lZCcsXG5cdChyZWFkZXIsIHRhcmdldCkgPT4ge1xuXHRcdGNvbnN0IGZsYWdzID0gcmVhZFVpbnQzMihyZWFkZXIpO1xuXHRcdHRhcmdldC5wcm90ZWN0ZWQgPSB7XG5cdFx0XHR0cmFuc3BhcmVuY3k6IChmbGFncyAmIDB4MDEpICE9PSAwLFxuXHRcdFx0Y29tcG9zaXRlOiAoZmxhZ3MgJiAweDAyKSAhPT0gMCxcblx0XHRcdHBvc2l0aW9uOiAoZmxhZ3MgJiAweDA0KSAhPT0gMCxcblx0XHR9O1xuXHR9LFxuXHQod3JpdGVyLCB0YXJnZXQpID0+IHtcblx0XHRjb25zdCBmbGFncyA9XG5cdFx0XHQodGFyZ2V0LnByb3RlY3RlZCEudHJhbnNwYXJlbmN5ID8gMHgwMSA6IDApIHxcblx0XHRcdCh0YXJnZXQucHJvdGVjdGVkIS5jb21wb3NpdGUgPyAweDAyIDogMCkgfFxuXHRcdFx0KHRhcmdldC5wcm90ZWN0ZWQhLnBvc2l0aW9uID8gMHgwNCA6IDApO1xuXG5cdFx0d3JpdGVVaW50MzIod3JpdGVyLCBmbGFncyk7XG5cdH0sXG4pO1xuXG5hZGRIYW5kbGVyKFxuXHQnbGNscicsXG5cdHRhcmdldCA9PiB0eXBlb2YgdGFyZ2V0LnNoZWV0Q29sb3JzICE9PSAndW5kZWZpbmVkJyxcblx0KHJlYWRlciwgdGFyZ2V0KSA9PiB7XG5cdFx0dGFyZ2V0LnNoZWV0Q29sb3JzID0ge1xuXHRcdFx0Y29sb3IxOiByZWFkVWludDMyKHJlYWRlciksXG5cdFx0XHRjb2xvcjI6IHJlYWRVaW50MzIocmVhZGVyKSxcblx0XHR9O1xuXHR9LFxuXHQod3JpdGVyLCB0YXJnZXQpID0+IHtcblx0XHR3cml0ZVVpbnQzMih3cml0ZXIsIHRhcmdldC5zaGVldENvbG9ycyEuY29sb3IxKTtcblx0XHR3cml0ZVVpbnQzMih3cml0ZXIsIHRhcmdldC5zaGVldENvbG9ycyEuY29sb3IyKTtcblx0fSxcbik7XG5cbmFkZEhhbmRsZXIoXG5cdCdmeHJwJyxcblx0dGFyZ2V0ID0+IHR5cGVvZiB0YXJnZXQucmVmZXJlbmNlUG9pbnQgIT09ICd1bmRlZmluZWQnLFxuXHQocmVhZGVyLCB0YXJnZXQpID0+IHtcblx0XHR0YXJnZXQucmVmZXJlbmNlUG9pbnQgPSB7XG5cdFx0XHR4OiByZWFkRmxvYXQ2NChyZWFkZXIpLFxuXHRcdFx0eTogcmVhZEZsb2F0NjQocmVhZGVyKSxcblx0XHR9O1xuXHR9LFxuXHQod3JpdGVyLCB0YXJnZXQpID0+IHtcblx0XHR3cml0ZUZsb2F0NjQod3JpdGVyLCB0YXJnZXQucmVmZXJlbmNlUG9pbnQhLngpO1xuXHRcdHdyaXRlRmxvYXQ2NCh3cml0ZXIsIHRhcmdldC5yZWZlcmVuY2VQb2ludCEueSk7XG5cdH0sXG4pO1xuXG5hZGRIYW5kbGVyKFxuXHQnbHNjdCcsXG5cdHRhcmdldCA9PiB0eXBlb2YgdGFyZ2V0LnNlY3Rpb25EaXZpZGVyICE9PSAndW5kZWZpbmVkJyxcblx0KHJlYWRlciwgdGFyZ2V0LCBsZWZ0KSA9PiB7XG5cdFx0Y29uc3QgaXRlbTogYW55ID0ge307XG5cblx0XHRpdGVtLnR5cGUgPSByZWFkVWludDMyKHJlYWRlcik7XG5cblx0XHRpZiAobGVmdCgpKSB7XG5cdFx0XHRjb25zdCBzaWduYXR1cmUgPSByZWFkU2lnbmF0dXJlKHJlYWRlcik7XG5cblx0XHRcdGlmIChzaWduYXR1cmUgIT09ICc4QklNJylcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHNpZ25hdHVyZTogJyR7c2lnbmF0dXJlfSdgKTtcblxuXHRcdFx0aXRlbS5rZXkgPSByZWFkU2lnbmF0dXJlKHJlYWRlcik7XG5cdFx0fVxuXG5cdFx0aWYgKGxlZnQoKSkge1xuXHRcdFx0Ly8gMCA9IG5vcm1hbFxuXHRcdFx0Ly8gMSA9IHNjZW5lIGdyb3VwLCBhZmZlY3RzIHRoZSBhbmltYXRpb24gdGltZWxpbmUuXG5cdFx0XHRpdGVtLnN1YlR5cGUgPSByZWFkVWludDMyKHJlYWRlcik7XG5cdFx0fVxuXG5cdFx0dGFyZ2V0LnNlY3Rpb25EaXZpZGVyID0gaXRlbTtcblx0fSxcblx0KHdyaXRlciwgdGFyZ2V0KSA9PiB7XG5cdFx0d3JpdGVVaW50MzIod3JpdGVyLCB0YXJnZXQuc2VjdGlvbkRpdmlkZXIhLnR5cGUpO1xuXG5cdFx0aWYgKHRhcmdldC5zZWN0aW9uRGl2aWRlciEua2V5KSB7XG5cdFx0XHR3cml0ZVNpZ25hdHVyZSh3cml0ZXIsICc4QklNJyk7XG5cdFx0XHR3cml0ZVNpZ25hdHVyZSh3cml0ZXIsIHRhcmdldC5zZWN0aW9uRGl2aWRlciEua2V5ISk7XG5cblx0XHRcdGlmICh0eXBlb2YgdGFyZ2V0LnNlY3Rpb25EaXZpZGVyIS5zdWJ0eXBlICE9PSAndW5kZWZpbmVkJylcblx0XHRcdFx0d3JpdGVVaW50MzIod3JpdGVyLCB0YXJnZXQuc2VjdGlvbkRpdmlkZXIhLnN1YnR5cGUhKTtcblx0XHR9XG5cdH0sXG4pO1xuXG5hZGRIYW5kbGVyKFxuXHQnRk1zaycsXG5cdHRhcmdldCA9PiB0eXBlb2YgdGFyZ2V0LmZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnLFxuXHQocmVhZGVyLCB0YXJnZXQpID0+IHtcblx0XHR0YXJnZXQuZmlsdGVyTWFzayA9IHtcblx0XHRcdGNvbG9yU3BhY2U6IHJlYWRDb2xvcihyZWFkZXIpLFxuXHRcdFx0b3BhY2l0eTogcmVhZFVpbnQxNihyZWFkZXIpLFxuXHRcdH07XG5cdH0sXG5cdCh3cml0ZXIsIHRhcmdldCkgPT4ge1xuXHRcdHdyaXRlQnl0ZXMod3JpdGVyLCBuZXcgVWludDhBcnJheSh0YXJnZXQuZmlsdGVyTWFzayEuY29sb3JTcGFjZSkpO1xuXHRcdHdyaXRlVWludDE2KHdyaXRlciwgdGFyZ2V0LmZpbHRlck1hc2shLm9wYWNpdHkpO1xuXHR9LFxuKTtcblxuYWRkSGFuZGxlcihcblx0J3NobWQnLFxuXHR0YXJnZXQgPT4gdHlwZW9mIHRhcmdldC5tZXRhZGF0YSAhPT0gJ3VuZGVmaW5lZCcsXG5cdChyZWFkZXIsIHRhcmdldCkgPT4ge1xuXHRcdGNvbnN0IGNvdW50ID0gcmVhZFVpbnQzMihyZWFkZXIpO1xuXHRcdHRhcmdldC5tZXRhZGF0YSA9IFtdO1xuXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG5cdFx0XHRjb25zdCBzaWduYXR1cmUgPSByZWFkU2lnbmF0dXJlKHJlYWRlcik7XG5cblx0XHRcdGlmIChzaWduYXR1cmUgIT09ICc4QklNJylcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHNpZ25hdHVyZTogJyR7c2lnbmF0dXJlfSdgKTtcblxuXHRcdFx0Y29uc3Qga2V5ID0gcmVhZFNpZ25hdHVyZShyZWFkZXIpO1xuXHRcdFx0Y29uc3QgY29weSA9ICEhcmVhZFVpbnQ4KHJlYWRlcik7XG5cdFx0XHRza2lwQnl0ZXMocmVhZGVyLCAzKTtcblx0XHRcdGNvbnN0IGxlbmd0aCA9IHJlYWRVaW50MzIocmVhZGVyKTtcblx0XHRcdGNvbnN0IGRhdGEgPSB0b0FycmF5KHJlYWRCeXRlcyhyZWFkZXIsIGxlbmd0aCkpO1xuXHRcdFx0dGFyZ2V0Lm1ldGFkYXRhLnB1c2goeyBrZXksIGNvcHksIGRhdGEgfSk7XG5cdFx0fVxuXHR9LFxuXHQod3JpdGVyLCB0YXJnZXQpID0+IHtcblx0XHR3cml0ZVVpbnQzMih3cml0ZXIsIHRhcmdldC5tZXRhZGF0YSEubGVuZ3RoKTtcblxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGFyZ2V0Lm1ldGFkYXRhIS5sZW5ndGg7IGkrKykge1xuXHRcdFx0Y29uc3QgaXRlbSA9IHRhcmdldC5tZXRhZGF0YSFbaV07XG5cdFx0XHR3cml0ZVNpZ25hdHVyZSh3cml0ZXIsICc4QklNJyk7XG5cdFx0XHR3cml0ZVNpZ25hdHVyZSh3cml0ZXIsIGl0ZW0ua2V5KTtcblx0XHRcdHdyaXRlVWludDgod3JpdGVyLCBpdGVtLmNvcHkgPyAxIDogMCk7XG5cdFx0XHR3cml0ZVplcm9zKHdyaXRlciwgMyk7XG5cdFx0XHR3cml0ZVVpbnQzMih3cml0ZXIsIGl0ZW0uZGF0YS5sZW5ndGgpO1xuXHRcdFx0d3JpdGVCeXRlcyh3cml0ZXIsIG5ldyBVaW50OEFycmF5KGl0ZW0uZGF0YSkpO1xuXHRcdH1cblx0fSxcbik7XG5cbmFkZEhhbmRsZXIoXG5cdCdseXZyJyxcblx0dGFyZ2V0ID0+IHR5cGVvZiB0YXJnZXQudmVyc2lvbiAhPT0gJ3VuZGVmaW5lZCcsXG5cdChyZWFkZXIsIHRhcmdldCkgPT4ge1xuXHRcdHRhcmdldC52ZXJzaW9uID0gcmVhZFVpbnQzMihyZWFkZXIpO1xuXHR9LFxuXHQod3JpdGVyLCB0YXJnZXQpID0+IHtcblx0XHR3cml0ZVVpbnQzMih3cml0ZXIsIHRhcmdldC52ZXJzaW9uISk7XG5cdH0sXG4pO1xuXG5hZGRIYW5kbGVyKFxuXHQnbHJGWCcsXG5cdHRhcmdldCA9PiB0eXBlb2YgdGFyZ2V0LmVmZmVjdHMgIT09ICd1bmRlZmluZWQnLFxuXHQocmVhZGVyLCB0YXJnZXQsIGxlZnQpID0+IHtcblx0XHR0YXJnZXQuZWZmZWN0cyA9IHJlYWRFZmZlY3RzKHJlYWRlcik7XG5cdFx0c2tpcEJ5dGVzKHJlYWRlciwgbGVmdCgpKTsgLy8gVEVNUDogc2tpcHBpbmdcblx0fSxcblx0KHdyaXRlciwgdGFyZ2V0KSA9PiB7XG5cdFx0d3JpdGVFZmZlY3RzKHdyaXRlciwgdGFyZ2V0LmVmZmVjdHMhKTtcblx0fSxcbik7XG4vKlxuYWRkSGFuZGxlcihcblx0J1R5U2gnLFxuXHRfdGFyZ2V0ID0+IGZhbHNlLCAvLyB0eXBlb2YgdGFyZ2V0LmVmZmVjdHMgIT09ICd1bmRlZmluZWQnLFxuXHQocmVhZGVyLCB0YXJnZXQpID0+IHtcblx0XHRjb25zdCB2ZXJzaW9uID0gcmVhZEludDE2KHJlYWRlcik7XG5cblx0XHRpZiAodmVyc2lvbiAhPT0gMSkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIFR5U2ggdmVyc2lvbjogJHt2ZXJzaW9ufWApO1xuXHRcdH1cblxuXHRcdGNvbnN0IHRyYW5zZm9ybSA9IFtcblx0XHRcdHJlYWRGbG9hdDY0KHJlYWRlciksXG5cdFx0XHRyZWFkRmxvYXQ2NChyZWFkZXIpLFxuXHRcdFx0cmVhZEZsb2F0NjQocmVhZGVyKSxcblx0XHRcdHJlYWRGbG9hdDY0KHJlYWRlciksXG5cdFx0XHRyZWFkRmxvYXQ2NChyZWFkZXIpLFxuXHRcdFx0cmVhZEZsb2F0NjQocmVhZGVyKSxcblx0XHRdO1xuXG5cdFx0Y29uc3QgdGV4dFZlcnNpb24gPSByZWFkSW50MTYocmVhZGVyKTtcblx0XHRjb25zdCBkZXNjcmlwdG9yVmVyc2lvbiA9IHJlYWRJbnQzMihyZWFkZXIpO1xuXG5cdFx0aWYgKHRleHRWZXJzaW9uICE9PSA1MCB8fCBkZXNjcmlwdG9yVmVyc2lvbiAhPT0gMTYpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBUeVNoIHRleHQgdmVyc2lvbjogJHt0ZXh0VmVyc2lvbn0vJHtkZXNjcmlwdG9yVmVyc2lvbn1gKTtcblx0XHR9XG5cblx0XHRjb25zdCB0ZXh0ID0gcmVhZERlc2NyaXB0b3JTdHJ1Y3R1cmUocmVhZGVyKTtcblxuXHRcdC8vIGNvbnNvbGUubG9nKCdFbmdpbmVEYXRhOicsIHBhcnNlRW5naW5lRGF0YSh0ZXh0LkVuZ2luZURhdGEpKTtcblxuXHRcdGNvbnN0IHdhcnBWZXJzaW9uID0gcmVhZEludDE2KHJlYWRlcik7XG5cdFx0Y29uc3Qgd2FycERlc2NyaXB0b3JWZXJzaW9uID0gcmVhZEludDMyKHJlYWRlcik7XG5cblx0XHRpZiAod2FycFZlcnNpb24gIT09IDEgfHwgd2FycERlc2NyaXB0b3JWZXJzaW9uICE9PSAxNikge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIFR5U2ggd2FycCB2ZXJzaW9uOiAke3dhcnBWZXJzaW9ufSAke3dhcnBEZXNjcmlwdG9yVmVyc2lvbn1gKTtcblx0XHR9XG5cblx0XHRjb25zdCB3YXJwID0gcmVhZERlc2NyaXB0b3JTdHJ1Y3R1cmUocmVhZGVyKTtcblxuXHRcdGNvbnN0IGxlZnQgPSByZWFkSW50MzIocmVhZGVyKTtcblx0XHRjb25zdCB0b3AgPSByZWFkSW50MzIocmVhZGVyKTtcblx0XHRjb25zdCByaWdodCA9IHJlYWRJbnQzMihyZWFkZXIpO1xuXHRcdGNvbnN0IGJvdHRvbSA9IHJlYWRJbnQzMihyZWFkZXIpO1xuXG5cdFx0dGFyZ2V0LnR5cGVUb29sT2JqZWN0U2V0dGluZyA9IHsgdHJhbnNmb3JtLCB0ZXh0LCB3YXJwLCBsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20gfTtcblx0fSxcblx0KF93cml0ZXIsIF90YXJnZXQpID0+IHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoJ25vdCBpbXBsZW1lbnRlZCcpO1xuXHR9LFxuKTtcblxuYWRkSGFuZGxlcihcblx0J1R4dDInLFxuXHR0YXJnZXQgPT4gdHlwZW9mIHRhcmdldC50ZXh0RW5naW5lRGF0YSAhPT0gJ3VuZGVmaW5lZCcsXG5cdChyZWFkZXIsIHRhcmdldCwgbGVmdCkgPT4ge1xuXHRcdHRhcmdldC50ZXh0RW5naW5lRGF0YSA9IEFycmF5LmZyb20ocmVhZEJ5dGVzKHJlYWRlciwgbGVmdCgpKSk7XG5cdH0sXG5cdCh3cml0ZXIsIHRhcmdldCkgPT4ge1xuXHRcdHdyaXRlQnl0ZXMod3JpdGVyLCBuZXcgVWludDhBcnJheSh0YXJnZXQudGV4dEVuZ2luZURhdGEhKSk7XG5cdH0sXG4pO1xuKi9cbmFkZEhhbmRsZXIoXG5cdCdsZngyJyxcblx0dGFyZ2V0ID0+IHR5cGVvZiB0YXJnZXQub2JqZWN0QmFzZWRFZmZlY3RzTGF5ZXJJbmZvICE9PSAndW5kZWZpbmVkJyxcblx0KHJlYWRlciwgX3RhcmdldCwgbGVmdCkgPT4ge1xuXHRcdHNraXBCeXRlcyhyZWFkZXIsIGxlZnQoKSk7XG5cdFx0Ly8gY29uc3QgdmVyc2lvbiA9IHJlYWRVaW50MzIocmVhZGVyKTtcblx0XHQvLyBjb25zdCBkZXNjcmlwdG9yVmVyc2lvbiA9IHJlYWRVaW50MzIocmVhZGVyKTtcblxuXHRcdC8vIGNvbnN0IG5hbWUgPSByZWFkZXIucmVhZFVuaWNvZGVTdHJpbmcoKTtcblx0XHQvLyBjb25zdCBjbGFzc0lkID0gcmVhZFN0cmluZ09yQ2xhc3NJZChyZWFkZXIpO1xuXHRcdC8vIGNvbnN0IGl0ZW1zQ291bnQgPSByZWFkVWludDMyKHJlYWRlcik7XG5cblx0XHQvL2ZvciAobGV0IGkgPSAwOyBpIDwgaXRlbXNDb3VudDsgaSsrKSB7XG5cdFx0Ly9cdGNvbnNvbGUubG9nKCdyZWFkIGl0ZW0nKTtcblx0XHQvL1x0Y29uc3Qga2V5ID0gcmVhZFN0cmluZ09yQ2xhc3NJZChyZWFkZXIpO1xuXHRcdC8vXHRjb25zb2xlLmxvZygna2V5JywgW2tleV0pO1xuXG5cdFx0Ly99XG5cblx0XHQvL3RhcmdldC5vYmplY3RCYXNlZEVmZmVjdHNMYXllckluZm8gPSB7XG5cdFx0Ly9cdHZlcnNpb24sXG5cdFx0Ly9cdGRlc2NyaXB0b3JWZXJzaW9uLFxuXHRcdC8vXHRkZXNjcmlwdG9yOiB7XG5cdFx0Ly9cdFx0bmFtZSxcblx0XHQvL1x0XHRjbGFzc0lkLFxuXHRcdC8vXHRcdC8vLi4uXG5cdFx0Ly9cdH0sXG5cdFx0Ly99O1xuXHR9LFxuXHQoX3dyaXRlciwgX3RhcmdldCkgPT4ge1xuXHRcdC8vLi4uXG5cdH0sXG4pO1xuXG4vLyBIZWxwZXJzXG5cbmZ1bmN0aW9uIHJlYWRBc2NpaVN0cmluZ09yQ2xhc3NJZChyZWFkZXI6IFBzZFJlYWRlcikge1xuXHRjb25zdCBsZW5ndGggPSByZWFkSW50MzIocmVhZGVyKTtcblx0cmV0dXJuIGxlbmd0aCA9PT0gMCA/IHJlYWRTaWduYXR1cmUocmVhZGVyKSA6IHJlYWRBc2NpaVN0cmluZyhyZWFkZXIsIGxlbmd0aCk7XG59XG5cbmZ1bmN0aW9uIHJlYWREZXNjcmlwdG9yU3RydWN0dXJlKHJlYWRlcjogUHNkUmVhZGVyKSB7XG5cdHJlYWRDbGFzc1N0cnVjdHVyZShyZWFkZXIpO1xuXHRjb25zdCBpdGVtc0NvdW50ID0gcmVhZFVpbnQzMihyZWFkZXIpO1xuXHRjb25zdCBvYmplY3Q6IGFueSA9IHt9O1xuXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbXNDb3VudDsgaSsrKSB7XG5cdFx0Y29uc3Qga2V5ID0gcmVhZEFzY2lpU3RyaW5nT3JDbGFzc0lkKHJlYWRlcik7XG5cdFx0Y29uc3QgdHlwZSA9IHJlYWRTaWduYXR1cmUocmVhZGVyKTtcblx0XHRjb25zdCBkYXRhID0gcmVhZE9TVHlwZShyZWFkZXIsIHR5cGUpO1xuXHRcdG9iamVjdFtrZXldID0gZGF0YTtcblx0fVxuXG5cdHJldHVybiBvYmplY3Q7XG59XG5cbmZ1bmN0aW9uIHJlYWRPU1R5cGUocmVhZGVyOiBQc2RSZWFkZXIsIHR5cGU6IHN0cmluZykge1xuXHRzd2l0Y2ggKHR5cGUpIHtcblx0XHRjYXNlICdvYmogJzogLy8gUmVmZXJlbmNlXG5cdFx0XHRyZXR1cm4gcmVhZFJlZmVyZW5jZVN0cnVjdHVyZShyZWFkZXIpO1xuXHRcdGNhc2UgJ09iamMnOiAvLyBEZXNjcmlwdG9yXG5cdFx0Y2FzZSAnR2xiTyc6IC8vIEdsb2JhbE9iamVjdCBzYW1lIGFzIERlc2NyaXB0b3Jcblx0XHRcdHJldHVybiByZWFkRGVzY3JpcHRvclN0cnVjdHVyZShyZWFkZXIpO1xuXHRcdGNhc2UgJ1ZsTHMnOiAvLyBMaXN0XG5cdFx0XHRyZXR1cm4gcmVhZExpc3RTdHJ1Y3R1cmUocmVhZGVyKTtcblx0XHRjYXNlICdkb3ViJzogLy8gRG91YmxlXG5cdFx0XHRyZXR1cm4gcmVhZEZsb2F0NjQocmVhZGVyKTtcblx0XHRjYXNlICdVbnRGJzogLy8gVW5pdCBkb3VibGVcblx0XHRcdHJldHVybiByZWFkVW5pdERvdWJsZVN0cnVjdHVyZShyZWFkZXIpO1xuXHRcdGNhc2UgJ1VuRmwnOiAvLyBVbml0IGZsb2F0XG5cdFx0XHRyZXR1cm4gcmVhZFVuaXRGbG9hdFN0cnVjdHVyZShyZWFkZXIpO1xuXHRcdGNhc2UgJ1RFWFQnOiAvLyBTdHJpbmdcblx0XHRcdHJldHVybiByZWFkVW5pY29kZVN0cmluZyhyZWFkZXIpO1xuXHRcdGNhc2UgJ2VudW0nOiAvLyBFbnVtZXJhdGVkXG5cdFx0XHRyZXR1cm4gcmVhZEVudW1lcmF0ZWQocmVhZGVyKTtcblx0XHRjYXNlICdsb25nJzogLy8gSW50ZWdlclxuXHRcdFx0cmV0dXJuIHJlYWRJbnQzMihyZWFkZXIpO1xuXHRcdGNhc2UgJ2NvbXAnOiAvLyBMYXJnZSBJbnRlZ2VyXG5cdFx0XHRyZXR1cm4gcmVhZExhcmdlSW50ZWdlcihyZWFkZXIpO1xuXHRcdGNhc2UgJ2Jvb2wnOiAvLyBCb29sZWFuXG5cdFx0XHRyZXR1cm4gISFyZWFkVWludDgocmVhZGVyKTtcblx0XHRjYXNlICd0eXBlJzogLy8gQ2xhc3Ncblx0XHRjYXNlICdHbGJDJzogLy8gQ2xhc3Ncblx0XHRcdHJldHVybiByZWFkQ2xhc3NTdHJ1Y3R1cmUocmVhZGVyKTtcblx0XHRjYXNlICdhbGlzJzogLy8gQWxpYXNcblx0XHRcdHJldHVybiByZWFkQWxpYXNTdHJ1Y3R1cmUocmVhZGVyKTtcblx0XHRjYXNlICd0ZHRhJzogLy8gUmF3IERhdGFcblx0XHRcdHJldHVybiByZWFkUmF3RGF0YShyZWFkZXIpO1xuXHRcdGNhc2UgJ09iQXInOiAvLyBPYmplY3QgYXJyYXlcblx0XHRcdHRocm93IG5ldyBFcnJvcignbm90IGltcGxlbWVudGVkOiBPYkFyJyk7XG5cdFx0Y2FzZSAnUHRoICc6IC8vIEZpbGUgcGF0aFxuXHRcdFx0cmV0dXJuIHJlYWRGaWxlUGF0aChyZWFkZXIpO1xuXHRcdGRlZmF1bHQ6XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgVHlTaCBkZXNjcmlwdG9yIE9TVHlwZTogJHt0eXBlfSBhdCAke3JlYWRlci5vZmZzZXQudG9TdHJpbmcoMTYpfWApO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHJlYWRSZWZlcmVuY2VTdHJ1Y3R1cmUocmVhZGVyOiBQc2RSZWFkZXIpIHtcblx0Y29uc3QgaXRlbXNDb3VudCA9IHJlYWRJbnQzMihyZWFkZXIpO1xuXHRjb25zdCBpdGVtczogYW55W10gPSBbXTtcblxuXHRmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW1zQ291bnQ7IGkrKykge1xuXHRcdGNvbnN0IHR5cGUgPSByZWFkU2lnbmF0dXJlKHJlYWRlcik7XG5cblx0XHRzd2l0Y2ggKHR5cGUpIHtcblx0XHRcdGNhc2UgJ3Byb3AnOiAvLyBQcm9wZXJ0eVxuXHRcdFx0XHRpdGVtcy5wdXNoKHJlYWRQcm9wZXJ0eVN0cnVjdHVyZShyZWFkZXIpKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdDbHNzJzogLy8gQ2xhc3Ncblx0XHRcdFx0aXRlbXMucHVzaChyZWFkQ2xhc3NTdHJ1Y3R1cmUocmVhZGVyKSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnRW5tcic6IC8vIEVudW1lcmF0ZWQgUmVmZXJlbmNlXG5cdFx0XHRcdGl0ZW1zLnB1c2gocmVhZEVudW1lcmF0ZWRSZWZlcmVuY2UocmVhZGVyKSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAncmVsZSc6IC8vIE9mZnNldFxuXHRcdFx0XHRpdGVtcy5wdXNoKHJlYWRPZmZzZXRTdHJ1Y3R1cmUocmVhZGVyKSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnSWRudCc6IC8vIElkZW50aWZpZXJcblx0XHRcdFx0aXRlbXMucHVzaChyZWFkSW50MzIocmVhZGVyKSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSAnaW5keCc6IC8vIEluZGV4XG5cdFx0XHRcdGl0ZW1zLnB1c2gocmVhZEludDMyKHJlYWRlcikpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgJ25hbWUnOiAvLyBOYW1lXG5cdFx0XHRcdGl0ZW1zLnB1c2gocmVhZFVuaWNvZGVTdHJpbmcocmVhZGVyKSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIFR5U2ggZGVzY3JpcHRvciBSZWZlcmVuY2UgdHlwZTogJHt0eXBlfWApO1xuXHRcdH1cblx0fVxuXG5cdHJldHVybiBpdGVtcztcbn1cblxuZnVuY3Rpb24gcmVhZFByb3BlcnR5U3RydWN0dXJlKHJlYWRlcjogUHNkUmVhZGVyKSB7XG5cdGNvbnN0IHsgbmFtZSwgY2xhc3NJRCB9ID0gcmVhZENsYXNzU3RydWN0dXJlKHJlYWRlcik7XG5cdGNvbnN0IGtleUlEID0gcmVhZEFzY2lpU3RyaW5nT3JDbGFzc0lkKHJlYWRlcik7XG5cdHJldHVybiB7IG5hbWUsIGNsYXNzSUQsIGtleUlEIH07XG59XG5cbmNvbnN0IHVuaXRzTWFwOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZzsgfSA9IHtcblx0JyNBbmcnOiAnQW5nbGUnLFxuXHQnI1JzbCc6ICdEZW5zaXR5Jyxcblx0JyNSbHQnOiAnRGlzdGFuY2UnLFxuXHQnI05uZSc6ICdOb25lJyxcblx0JyNQcmMnOiAnUGVyY2VudCcsXG5cdCcjUHhsJzogJ1BpeGVscycsXG5cdCcjTWxtJzogJ01pbGxpbWV0ZXJzJyxcblx0JyNQbnQnOiAnUG9pbnRzJyxcbn07XG5cbmZ1bmN0aW9uIHJlYWRVbml0RG91YmxlU3RydWN0dXJlKHJlYWRlcjogUHNkUmVhZGVyKSB7XG5cdGNvbnN0IHVuaXRzID0gcmVhZFNpZ25hdHVyZShyZWFkZXIpO1xuXHRjb25zdCB2YWx1ZSA9IHJlYWRGbG9hdDY0KHJlYWRlcik7XG5cdHJldHVybiB7IHVuaXRzOiB1bml0c01hcFt1bml0c10sIHZhbHVlIH07XG59XG5cbmZ1bmN0aW9uIHJlYWRVbml0RmxvYXRTdHJ1Y3R1cmUocmVhZGVyOiBQc2RSZWFkZXIpIHtcblx0Y29uc3QgdW5pdHMgPSByZWFkU2lnbmF0dXJlKHJlYWRlcik7XG5cdGNvbnN0IHZhbHVlID0gcmVhZEZsb2F0MzIocmVhZGVyKTtcblx0cmV0dXJuIHsgdW5pdHM6IHVuaXRzTWFwW3VuaXRzXSwgdmFsdWUgfTtcbn1cblxuZnVuY3Rpb24gcmVhZENsYXNzU3RydWN0dXJlKHJlYWRlcjogUHNkUmVhZGVyKSB7XG5cdGNvbnN0IG5hbWUgPSByZWFkVW5pY29kZVN0cmluZyhyZWFkZXIpO1xuXHRjb25zdCBjbGFzc0lEID0gcmVhZEFzY2lpU3RyaW5nT3JDbGFzc0lkKHJlYWRlcik7XG5cdHJldHVybiB7IG5hbWUsIGNsYXNzSUQgfTtcbn1cblxuZnVuY3Rpb24gcmVhZEVudW1lcmF0ZWRSZWZlcmVuY2UocmVhZGVyOiBQc2RSZWFkZXIpIHtcblx0Y29uc3QgeyBuYW1lLCBjbGFzc0lEIH0gPSByZWFkQ2xhc3NTdHJ1Y3R1cmUocmVhZGVyKTtcblx0Y29uc3QgVHlwZUlEID0gcmVhZEFzY2lpU3RyaW5nT3JDbGFzc0lkKHJlYWRlcik7XG5cdGNvbnN0IHZhbHVlID0gcmVhZEFzY2lpU3RyaW5nT3JDbGFzc0lkKHJlYWRlcik7XG5cdHJldHVybiB7IG5hbWUsIGNsYXNzSUQsIFR5cGVJRCwgdmFsdWUgfTtcbn1cblxuZnVuY3Rpb24gcmVhZE9mZnNldFN0cnVjdHVyZShyZWFkZXI6IFBzZFJlYWRlcikge1xuXHRjb25zdCB7IG5hbWUsIGNsYXNzSUQgfSA9IHJlYWRDbGFzc1N0cnVjdHVyZShyZWFkZXIpO1xuXHRjb25zdCB2YWx1ZSA9IHJlYWRVaW50MzIocmVhZGVyKTtcblx0cmV0dXJuIHsgbmFtZSwgY2xhc3NJRCwgdmFsdWUgfTtcbn1cblxuZnVuY3Rpb24gcmVhZEFsaWFzU3RydWN0dXJlKHJlYWRlcjogUHNkUmVhZGVyKSB7XG5cdGNvbnN0IGxlbmd0aCA9IHJlYWRJbnQzMihyZWFkZXIpO1xuXHRyZXR1cm4gcmVhZEFzY2lpU3RyaW5nKHJlYWRlciwgbGVuZ3RoKTtcbn1cblxuZnVuY3Rpb24gcmVhZExpc3RTdHJ1Y3R1cmUocmVhZGVyOiBQc2RSZWFkZXIpIHtcblx0Y29uc3QgbGVuZ3RoID0gcmVhZEludDMyKHJlYWRlcik7XG5cdGNvbnN0IHR5cGUgPSByZWFkU2lnbmF0dXJlKHJlYWRlcik7XG5cdGNvbnN0IGl0ZW1zOiBhbnlbXSA9IFtdO1xuXG5cdGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcblx0XHRpdGVtcy5wdXNoKHJlYWRPU1R5cGUocmVhZGVyLCB0eXBlKSk7XG5cdH1cblxuXHRyZXR1cm4gaXRlbXM7XG59XG5cbmZ1bmN0aW9uIHJlYWRMYXJnZUludGVnZXIocmVhZGVyOiBQc2RSZWFkZXIpIHtcblx0Y29uc3QgbG93ID0gcmVhZFVpbnQzMihyZWFkZXIpO1xuXHRjb25zdCBoaWdoID0gcmVhZFVpbnQzMihyZWFkZXIpO1xuXHRyZXR1cm4geyBsb3csIGhpZ2ggfTtcbn1cblxuZnVuY3Rpb24gcmVhZEVudW1lcmF0ZWQocmVhZGVyOiBQc2RSZWFkZXIpIHtcblx0Y29uc3QgdHlwZSA9IHJlYWRBc2NpaVN0cmluZ09yQ2xhc3NJZChyZWFkZXIpO1xuXHRjb25zdCB2YWx1ZSA9IHJlYWRBc2NpaVN0cmluZ09yQ2xhc3NJZChyZWFkZXIpO1xuXHRyZXR1cm4gYCR7dHlwZX0uJHt2YWx1ZX1gO1xufVxuXG5mdW5jdGlvbiByZWFkUmF3RGF0YShyZWFkZXI6IFBzZFJlYWRlcikge1xuXHRjb25zdCBsZW5ndGggPSByZWFkSW50MzIocmVhZGVyKTtcblx0cmV0dXJuIEFycmF5LmZyb20ocmVhZEJ5dGVzKHJlYWRlciwgbGVuZ3RoKSk7XG59XG5cbmZ1bmN0aW9uIHJlYWRGaWxlUGF0aChyZWFkZXI6IFBzZFJlYWRlcikge1xuXHRjb25zdCBsZW5ndGggPSByZWFkSW50MzIocmVhZGVyKTtcblx0Y29uc3Qgc2lnID0gcmVhZFNpZ25hdHVyZShyZWFkZXIpO1xuXHRjb25zdCBwYXRoU2l6ZSA9IHJlYWRJbnQzMkxFKHJlYWRlcik7XG5cdGNvbnN0IGNoYXJzQ291bnQgPSByZWFkSW50MzJMRShyZWFkZXIpO1xuXHRjb25zdCBwYXRoID0gcmVhZFVuaWNvZGVTdHJpbmdXaXRoTGVuZ3RoKHJlYWRlciwgY2hhcnNDb3VudCk7XG5cblx0bGVuZ3RoO1xuXHRwYXRoU2l6ZTtcblxuXHRyZXR1cm4geyBzaWcsIHBhdGggfTtcbn1cbiJdLCJzb3VyY2VSb290IjoiRDpcXFByb2plY3RzXFxnaXRodWJcXGFnLXBzZFxcc3JjIn0=
